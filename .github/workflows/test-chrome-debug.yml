name: Test Chrome Debug

on:
  workflow_dispatch:

jobs:
  test-chrome:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout código
        uses: actions/checkout@v4
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Instalar Chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: stable
      
      - name: Verificar Chrome
        run: |
          echo "=== Versión de Chrome ==="
          google-chrome --version
          which google-chrome
          
          echo "=== Info del sistema ==="
          uname -a
          cat /etc/os-release
          free -h
          
      - name: Instalar dependencias
        run: |
          pip install selenium webdriver-manager beautifulsoup4
      
      - name: Test Chrome simple
        run: |
          python -c "
          from selenium import webdriver
          from selenium.webdriver.chrome.service import Service
          from webdriver_manager.chrome import ChromeDriverManager
          import time

          print('=== Creando opciones de Chrome ===')
          options = webdriver.ChromeOptions()
          options.add_argument('--headless=new')
          options.add_argument('--no-sandbox')
          options.add_argument('--disable-dev-shm-usage')
          options.add_argument('--disable-gpu')
          options.add_argument('--disable-extensions')
          options.add_argument('--disable-software-rasterizer')
          options.add_argument('--remote-debugging-port=9222')
          options.add_argument('--window-size=1920,1080')
          options.add_argument('--single-process')
          options.add_argument('--disable-features=VizDisplayCompositor')
          
          print('=== Iniciando Chrome ===')
          try:
              driver = webdriver.Chrome(
                  service=Service(ChromeDriverManager().install()), 
                  options=options
              )
              print('✓ Chrome iniciado correctamente')
              
              print('=== Navegando a Google Maps ===')
              url = 'https://www.google.com/maps/place/El+Boliche+de+Alberto/@-38.9399,-68.0565,17z'
              driver.get(url)
              print(f'✓ Navegación exitosa')
              print(f'Title: {driver.title}')
              
              print('=== Esperando 5 segundos ===')
              time.sleep(5)
              
              print('=== Verificando página cargada ===')
              print(f'Current URL: {driver.current_url}')
              print(f'Page source length: {len(driver.page_source)}')
              
              print('=== Cerrando Chrome ===')
              driver.quit()
              print('✓ Test completado exitosamente!')
              
          except Exception as e:
              print(f'❌ ERROR: {e}')
              import traceback
              traceback.print_exc()
          "
      
      - name: Test con múltiples intentos
        run: |
          python -c "
          from selenium import webdriver
          from selenium.webdriver.chrome.service import Service
          from webdriver_manager.chrome import ChromeDriverManager
          import time

          def crear_driver():
              options = webdriver.ChromeOptions()
              options.add_argument('--headless=new')
              options.add_argument('--no-sandbox')
              options.add_argument('--disable-dev-shm-usage')
              options.add_argument('--disable-gpu')
              options.add_argument('--disable-extensions')
              options.add_argument('--single-process')
              return webdriver.Chrome(
                  service=Service(ChromeDriverManager().install()), 
                  options=options
              )

          for i in range(3):
              print(f'=== Intento {i+1}/3 ===')
              try:
                  driver = crear_driver()
                  driver.get('https://www.google.com/maps')
                  print(f'✓ Intento {i+1} exitoso')
                  time.sleep(2)
                  driver.quit()
              except Exception as e:
                  print(f'❌ Intento {i+1} falló: {e}')
              time.sleep(1)
          
          print('=== Test de múltiples drivers completado ===')
          "
