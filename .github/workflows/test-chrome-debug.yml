name: Test Chrome Debug

on:
  workflow_dispatch:

jobs:
  test-chrome:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout código
        uses: actions/checkout@v4
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Instalar Chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: stable
      
      - name: Verificar Chrome
        run: |
          echo "=== Versión de Chrome ==="
          google-chrome --version
          which google-chrome
          
          echo "=== Info del sistema ==="
          free -h
          df -h
          
      - name: Instalar dependencias
        run: |
          pip install selenium webdriver-manager beautifulsoup4
      
      - name: Test Chrome con shm-size configurado
        run: |
          python -c "
          from selenium import webdriver
          from selenium.webdriver.chrome.service import Service
          from webdriver_manager.chrome import ChromeDriverManager
          import time

          print('=== Test 1: Configuración mínima ===')
          options = webdriver.ChromeOptions()
          options.add_argument('--headless')
          options.add_argument('--no-sandbox')
          options.add_argument('--disable-dev-shm-usage')
          
          try:
              driver = webdriver.Chrome(
                  service=Service(ChromeDriverManager().install()), 
                  options=options
              )
              print('✓ Chrome iniciado')
              driver.get('https://www.google.com')
              print(f'✓ Google cargado: {driver.title}')
              driver.quit()
              print('✓ Test 1 PASÓ')
          except Exception as e:
              print(f'❌ Test 1 FALLÓ: {e}')
          
          time.sleep(2)
          
          print('')
          print('=== Test 2: Navegando a Maps ===')
          options2 = webdriver.ChromeOptions()
          options2.add_argument('--headless')
          options2.add_argument('--no-sandbox')
          options2.add_argument('--disable-dev-shm-usage')
          options2.add_argument('--disable-gpu')
          options2.add_argument('--window-size=1920,1080')
          
          try:
              driver = webdriver.Chrome(
                  service=Service(ChromeDriverManager().install()), 
                  options=options2
              )
              print('✓ Chrome iniciado')
              driver.set_page_load_timeout(30)
              driver.get('https://www.google.com/maps/place/Buenos+Aires')
              print(f'✓ Maps cargado')
              print(f'  URL: {driver.current_url[:50]}...')
              time.sleep(3)
              driver.quit()
              print('✓ Test 2 PASÓ')
          except Exception as e:
              print(f'❌ Test 2 FALLÓ: {e}')
          "
